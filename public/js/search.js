const menu = [
    {
        title: "Color Management",
        link: "/color-management",
        startIndex: 0,
        child: [
            {
                title: "Cocoa Butter",
                link: "/color-management/cocoa-butter"
            },
            {
                title: "Color Powder Repack",
                link: "/color-management/color-powder"
            },
            {
                title: "Printing",
                link: "/color-management/printings"
            },
        ]
    },
    {
        title: "Company",
        link: "/companies",
        startIndex: 0,
        child: [

        ]
    },
    {
        title: "Customer",
        link: "/customer",
        startIndex: 0,
        child: [
            {
                title: "Manage Customer",
                link: "/customer"
            },
            {
                title: "Manage Email For Customer",
                link: "/customer/email-customer"
            },
        ]
    },
    {
        title: "Document Management",
        link: "/document-management",
        startIndex: 0,
        child: [
            {
                title: "Admin",
                link: "/document-management/document-admin"
            },
            {
                title: "Designer",
                link: "/document-management/document-designer"
            },
            {
                title: "Finance",
                link: "/document-management/document-finance"
            },
            {
                title: "Human Resource",
                link: "/document-management/human-resource"
            },
            {
                title: "Hygiene",
                link: "/document-management/document-hygiene"
            },
            {
                title: "Category",
                link: "/document-management/categories"
            },
        ]
    },
    {
        title: "Engineering",
        link: "/engineering",
        startIndex: 0,
        child: [
            {
                title: "Manage Data Machine",
                link: "/engineering/manage-machine"
            },
            {
                title: "Manage Maintenance Schedule",
                link: "/engineering/maintenance-schedule"
            },
            {
                title: "Manage Sparepart",
                link: "/engineering/sparepart"
            },
        ]
    },
    {
        title: "Finance",
        link: "/finance",
        startIndex: 0,
        child: [
            {
                title: "Asset Depreciation Setup",
                link: "/finance/asset"
            },
            {
                title: "Chart Of Account",
                link: "/finance/chart-of-account"
            },
            {
                title: "Exchange Rate",
                link: "/finance/exchange-rate"
            },
            {
                title: "Financial Reporting",
                link: "/finance"
            },
            {
                title: "Jurnal",
                link: "/finance/journal"
            },
            {
                title: "Manage Monthly Budgeting",
                link: "/finance"
            },
            {
                title: "Purchase Order Payment",
                link: "/finance"
            },
            {
                title: "Sales Order Payment",
                link: "/finance"
            },
        ]
    },
    {
        title: "Human Resource",
        link: "/human-resource",
        startIndex: 0,
        child: [
            {
                title: "Employee Management",
                link: "/human-resource/employee"
            },
            {
                title: "Manage Employee Training",
                link: "/human-resource/employee-training"
            },
            {
                title: "Salary Setup Management",
                link: "/human-resource/salary-setup/employee-salary"
            },
        ]
    },
    {
        title: "Task",
        link: "/task",
        startIndex: 0,
        child: [
            {
                title: "Task Management",
                link: "/task/management-task"
            },
            {
                title: "My Task",
                link: "/task/my-task"
            },
        ]
    },
    {
        title: "Inventory",
        link: "/inventory",
        startIndex: 0,
        child: [
            {
                title: "Boutique Category",
                link: "/inventory/inventory-boutique"
            },
            {
                title: "Box Type Setup",
                link: "/inventory/box-type"
            },
            {
                title: "Festivity Management",
                link: "/inventory/festivity"
            },
            {
                title: "Product (By Customer)",
                link: "/inventory/product-customer"
            },
            {
                title: "Product (In Catalog)",
                link: "/inventory/product-catalog"
            },
            {
                title: "Product Category",
                link: "/inventory/product-category"
            },
            {
                title: "Raw Material (Food)",
                link: "/inventory/material-food"
            },
            {
                title: "Raw Material (Non Food)",
                link: "/inventory/material-non-food"
            },
            {
                title: "Raw Material Repack",
                link: "/inventory/material-repack"
            },
        ]
    },
    {
        title: "Mini ERP",
        link: "/mini-erp",
        startIndex: 0,
        child: [
            {
                title: "Chef Management",
                link: "/mini-erp/chef"
            },
            {
                title: "Inventory Management",
                link: "/mini-erp/inventory"
            },
            {
                title: "Recipe Management",
                link: "/mini-erp/recipe"
            },
        ]
    },
    {
        title: "Packing Management",
        link: "/packing-management",
        startIndex: 0,
        child: [
            {
                title: "Packing Box",
                link: "/packing-management/packing-box"
            },
            {
                title: "Shipment Schedule",
                link: "/packing-management/release-shipment"
            },
        ]
    },
    {
        title: "Pastry Private Course",
        link: "/pastry-private-course",
        startIndex: 0,
        child: [

        ]
    },
    {
        title: "Production Process",
        link: "/production-process",
        startIndex: 0,
        child: [
            {
                title: "Base Color",
                link: "/production-process/base-color"
            },
            {
                title: "Bon Bon & Chocolate Modelling (Production Proccess)",
                link: "/production-process/bonbon/production-process",
            },
            {
                title: "Bon Bon & Chocolate Modelling (Labelling)",
                link: "/production-process/bonbon/print-label",
            },
            {
                title: "Bon Bon & Chocolate Modelling (Schedule)",
                link: "/production-process/bonbon/schedule",
            },
            {
                title: "Bon Bon & Chocolate Modelling (Production Report)",
                link: "/production-process/bonbon/schedule",
            },
            {
                title: "Color Cocoa Butter",
                link: "/production-process"
            },
            {
                title: "Color Powder Repack",
                link: "/production-process"
            },
            {
                title: "Finish Product",
                link: "/production-process"
            },
            {
                title: "HACCP REPORT",
                link: "/production-process"
            },
            {
                title: "Printing",
                link: "/production-process"
            },
            {
                title: "Recipe Regulation",
                link: "/production-process"
            },
            {
                title: "Roboqbo Production Process",
                link: "/production-process"
            },
            {
                title: "Specification Report",
                link: "/production-process"
            },
        ]
    },
    {
        title: "Purchase Order",
        link: "/purchasing-order",
        startIndex: 0,
        child: [
            {
                title: "Purchasing Order List",
                link: "/purchasing-order"
            },
            {
                title: "Purchasing Order Report",
                link: "/purchasing-order/report-po"
            },
            {
                title: "Approval Purchase Order",
                link: "/purchasing-order/approval-po"
            },
            {
                title: "Receiving Process From PO",
                link: "/purchasing-order/receive"
            },
            {
                title: "Print Label",
                link: "/purchasing-order/print-label"
            },
            {
                title: "History Product",
                link: "/purchasing-order/history"
            },
        ]
    },
    {
        title: "Recipe Management",
        link: "/recipe-management",
        startIndex: 0,
        child: [
            {
                title: "Chocolate Component",
                link: "/recipe-management/chocolate-component"
            },
            {
                title: "Manage Recipe Master",
                link: "/recipe-management/manage-recipe-master"
            },
            {
                title: "Recipe Catogory",
                link: "/recipe-management/recipe-category"
            },
            {
                title: "Recipe Reference Link",
                link: "/recipe-management/recipe-reference-data"
            },
        ]
    },
    {
        title: "Roboqbo Production System",
        link: "/roboqbo-production-system/link-product/",
        startIndex: 0,
        child: [
            {
                title: "Roboqbo Setup",
                link: "/roboqbo-production-system/link-product"
            },
             {
                title: "Roboqbo Tools",
                link: "/roboqbo-production-system/tools"
            },
        ]
    },
    {
        title: "Role",
        link: "/roles",
        startIndex: 0,
        child: [

        ]
    },
    {
        title: "Sales Order",
        link: "/sales-order",
        startIndex: 0,
        child: [
            {
                title: "Boutique Gourmet",
                link: "/sales-order"
            },
            {
                title: "Sales Order (ONLINE)",
                link: "/sales-order"
            },
            {
                title: "Sales Order (Quotation)",
                link: "/sales-order/quotation"
            },
            {
                title: "Sales Order (Regular)",
                link: "/sales-order/reguler"
            },
            {
                title: "Sales Target Setup",
                link: "/sales-order/sales-target"
            },
            {
                title: "Voucher",
                link: "/sales-order/voucher"
            },
        ]
    },
    {
        title: "Supplier",
        link: "/suppliers",
        startIndex: 0,
        child: [

        ]
    },
    {
        title: "Website Management",
        link: "/website-management",
        startIndex: 0,
        child: [
            {
                title: "Catalog Picture",
                link: "/website-management/catalog-picture"
            },
            {
                title: "Home Boutique",
                link: "/website-management/home-boutique"
            },
            {
                title: "Home Executive Professional",
                link: "/website-management/home-executive"
            },
            {
                title: "Intro Picture",
                link: "/website-management/intro-picture"
            },
            {
                title: "Manage Video Tutorial",
                link: "/website-management/video-tutorial"
            },
        ]
    },
];

$("#search").focusout(function(){
    setTimeout(() => {
        $("#listFiltered").addClass('d-none');
    }, 200);
});

$("#search").focusin(function(){
    $("#listFiltered").removeClass('d-none');
});

let liSelected;
let liIndex;
let liNext;
let aSelected;
let selected;
let status;

$("#search").keyup((e) => {
    $("#listFiltered").html("")
    const inputText = e.target.value.toLowerCase();
    const inputLength = inputText.length;
    console.log(e);

    if (inputLength > 0 && inputText.trim() != "") {
        let filtered = menu.filter((data, key, array) => {
            // let index = data.title.toLowerCase().replace(/\s/g, '').indexOf(inputText.replace(/\s/g, ''));
            let index = data.title.toLowerCase().indexOf(inputText);
            if (index !== -1) {
                array[key].startIndex = index;
                return true;
            }
            return false;
        });

        let li = "";

        filtered.forEach(data => {
            const getText = data.title.substring(data.startIndex, data.startIndex + inputLength);
            const boldText = `<b>${getText}</b>`;
            const firstText = data.title.slice(0, data.startIndex);
            const lastText = data.title.slice(data.startIndex + inputLength);
            const title = firstText + boldText + lastText;
            li +=  `<li>
                        <a href="${data.link}">${title}</a>
                        ${data.child.length > 0 ?
                            `<ul>
                                ${Object.keys(data.child).map(function (key) {
                                    return "<li><a href='" + data.child[key].link + "'>" + data.child[key].title + "</a></li>"
                                }).join("")}
                            </ul>`
                        : ''}

                    </li>`
        });

        $("#listFiltered").html(li)
    }

    var li = $('#listFiltered > li');

    li.eq(liIndex).addClass('selected');
    li.eq(liIndex).children('a').addClass('background');
});

$('#search').keydown((e) => {
    var li = $('#listFiltered > li');

    li.eq(liIndex).removeClass('selected');
    li.eq(liIndex).children('a').removeClass('background');

    if(e.which === 40){
        if(liSelected){
            liSelected.removeClass('selected');
            aSelected.removeClass('background');

            if (status == "up") {
                next = li.eq(liNext);
            } else {
                next = li.eq(liNext + 2);
                liNext += 2;
            }

            if(next.length > 0){
                liIndex = liNext;
                liNext += 1;
                liSelected = next;
                next.addClass('selected');
                aSelected = next.children('a');
                next.children('a').addClass('background');
            }else{
                liNext = 1;
                liIndex = 0;
                li.eq(0).addClass('selected');
                liSelected = li.eq(0);
                li.eq(0).children('a').addClass('background');
                aSelected =  li.eq(0).children('a');
            }
        }else{
            liNext = 1;
            liIndex = 0;
            li.eq(0).addClass('selected');
            liSelected = li.eq(0);
            li.eq(0).children('a').addClass('background');
            aSelected =  li.eq(0).children('a');
        }

        status = "up"
    }else if(e.which === 38){
        if(liSelected){
            liSelected.removeClass('selected');
            aSelected.removeClass('background');

            if (status == "down") {
                next = li.eq(liNext);
            } else {
                next = li.eq(liNext - 2);
                liNext -= 2;
            }

            if(next.length > 0){
                liIndex = liNext;
                liNext -= 1;
                liSelected = next;
                next.addClass('selected');
                aSelected = next.children('a');
                next.children('a').addClass('background');
            }else{
                liNext = -2;
                liIndex = -1;
                li.eq(-1).addClass('selected');
                liSelected = li.eq(-1);
                li.eq(-1).children('a').addClass('background');
                aSelected =  li.eq(-1).children('a');
            }
        }else{
                liNext = -2;
                liIndex = -1;
                li.eq(-1).addClass('selected');
                liSelected = li.eq(-1);
                li.eq(-1).children('a').addClass('background');
                aSelected =  li.eq(-1).children('a');
        }

        status = "down"
    } else if(e.which == 13) {
        const link = li.eq(liIndex).children('a').attr('href');
        if (link) {
            window.location.href = link;
        }
    } else if(e.key == "Escape") {
        $('#search').blur();
        e.preventDefault()
    } else {
        li.eq(liIndex).addClass('selected');
        li.eq(liIndex).children('a').addClass('background');
    }
});

// Shorcut f => input search focus
// $(document).keyup(function(event) {
//     if (event.which === 70)
//     {
//         $('#search').focus();
//         event.preventDefault();
//     }
// });

String.prototype.replaceAt = function(index, replacement) {
    return this.substr(0, index) + replacement + this.substr(index + replacement.length);
}
